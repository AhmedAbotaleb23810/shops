<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<title>تطبيق بيع المنتجات - المشتري</title>
<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #f0f4f8;
  direction: rtl;
  padding: 20px;
  color: #333;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
}
h1 {
  text-align: center;
  color: #34495e;
  margin-bottom: 25px;
  font-weight: 700;
}
#search {
  padding: 12px 15px;
  font-size: 16px;
  border: 1.8px solid #ccc;
  border-radius: 8px;
  margin-bottom: 20px;
  width: 100%;
  max-width: 400px;
}
table {
  width: 100%;
  max-width: 900px;
  border-collapse: collapse;
  background: white;
  box-shadow: 0 3px 10px rgba(0,0,0,0.12);
  border-radius: 12px;
  overflow: hidden;
}
th, td {
  padding: 15px 18px;
  border-bottom: 1px solid #eee;
  text-align: center;
}
th {
  background-color: #2980b9;
  color: white;
  font-weight: 600;
}
tr:hover {
  background-color: #f5faff;
}
button {
  padding: 7px 14px;
  font-size: 14px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  background-color: #27ae60;
  color: white;
  transition: background-color 0.3s ease;
}
button:disabled {
  background-color: #ccc;
  cursor: not-allowed;
}
button:hover:not(:disabled) {
  background-color: #1e8449;
}
</style>
</head>
<body>

<h1>🛍️ قائمة المنتجات</h1>
<input id="search" placeholder="🔍 بحث عن منتج" oninput="renderProducts()" />

<table>
<thead>
<tr>
  <th>اسم المنتج</th>
  <th>السعر</th>
  <th>الكمية</th>
  <th>شراء</th>
</tr>
</thead>
<tbody id="productTable"></tbody>
</table>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

<script>
// ضع بيانات مشروعك هنا
const firebaseConfig = {
  apiKey: "PUT_YOUR_KEY_HERE",
  authDomain: "PUT_YOUR_AUTH_DOMAIN",
  databaseURL: "https://appjx-d8c22-default-rtdb.firebaseio.com",
  projectId: "PUT_YOUR_PROJECT_ID",
  storageBucket: "PUT_YOUR_STORAGE_BUCKET",
  messagingSenderId: "PUT_YOUR_SENDER_ID",
  appId: "PUT_YOUR_APP_ID"
};

// تهيئة Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const productsRef = db.ref("products");

let products = [];

productsRef.on("value", snapshot => {
  products = [];
  snapshot.forEach(childSnapshot => {
    products.push({ id: childSnapshot.key, ...childSnapshot.val() });
  });
  renderProducts();
});

function renderProducts() {
  const search = document.getElementById("search").value.trim().toLowerCase();
  const tbody = document.getElementById("productTable");
  tbody.innerHTML = "";

  products
    .filter(p => p.name.toLowerCase().includes(search))
    .forEach(product => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${product.name}</td>
        <td>${product.price.toFixed(2)}</td>
        <td>${product.quantity}</td>
        <td>
          <button ${product.quantity === 0 ? "disabled" : ""} onclick="buyProduct('${product.id}', ${product.quantity})">شراء</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
}

function buyProduct(id, quantity) {
  if (quantity > 0) {
    db.ref("products/" + id).update({ quantity: quantity - 1 });
  }
}
</script>

</body>
</html>
