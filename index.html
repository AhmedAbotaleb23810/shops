<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>ØªØ·Ø¨ÙŠÙ‚ Ø¨ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª - Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¨Ø§Ø¦Ø¹</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f4f8;
      direction: rtl;
      padding: 20px;
      color: #333;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      text-align: center;
      color: #34495e;
      margin-bottom: 25px;
      font-weight: 700;
      letter-spacing: 1.5px;
    }
    .input-group {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
      width: 100%;
      max-width: 900px;
    }
    input, select, button {
      padding: 12px 15px;
      font-size: 16px;
      border: 1.8px solid #ccc;
      border-radius: 8px;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    input:focus, select:focus {
      outline: none;
      border-color: #2980b9;
      box-shadow: 0 0 8px rgba(41, 128, 185, 0.5);
    }
    button {
      cursor: pointer;
      background-color: #2980b9;
      color: white;
      border: none;
      border-radius: 8px;
      transition: background-color 0.3s ease, transform 0.15s ease;
    }
    button:hover {
      background-color: #1c5980;
      transform: scale(1.05);
    }
    #clearAll {
      background-color: #c0392b;
      margin-left: auto;
      transition: background-color 0.3s ease;
    }
    #clearAll:hover {
      background-color: #8e2817;
    }
    #search {
      width: 100%;
      max-width: 400px;
    }
    select {
      min-width: 140px;
    }
    table {
      width: 100%;
      max-width: 900px;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 3px 10px rgba(0,0,0,0.12);
      border-radius: 12px;
      overflow: hidden;
    }
    th, td {
      padding: 15px 18px;
      border-bottom: 1px solid #eee;
      text-align: center;
    }
    th {
      background-color: #2980b9;
      color: white;
      cursor: pointer;
      user-select: none;
      font-weight: 600;
    }
    th:hover {
      background-color: #1c5980;
    }
    tr:hover:not(.editing) {
      background-color: #f5faff;
    }
    .actions button {
      margin: 0 4px;
      padding: 7px 14px;
      font-size: 14px;
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.12);
    }
    .actions button:hover {
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
    }
    .actions button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .editInput {
      width: 90%;
      padding: 8px 10px;
      font-size: 15px;
      border-radius: 6px;
      border: 1.5px solid #ccc;
    }
    .saveBtn, .cancelBtn {
      padding: 7px 15px;
      font-weight: 600;
      transition: background-color 0.3s ease;
    }
    .saveBtn {
      background-color: #27ae60;
      color: white;
    }
    .saveBtn:hover {
      background-color: #1e8449;
    }
    .cancelBtn {
      background-color: #c0392b;
      color: white;
    }
    .cancelBtn:hover {
      background-color: #8e2817;
    }
    #totalValue {
      margin-top: 20px;
      font-weight: 700;
      font-size: 20px;
      color: #27ae60;
      text-align: center;
      max-width: 900px;
    }
    .message {
      text-align: center;
      margin-top: 15px;
      font-weight: 700;
      color: #27ae60;
      display: none;
    }

    /* Responsive for smaller screens */
    @media (max-width: 700px) {
      .input-group {
        flex-direction: column;
        align-items: stretch;
      }
      input, select, button {
        width: 100% !important;
        margin: 5px 0;
      }
      table, #totalValue {
        max-width: 100%;
        font-size: 14px;
      }
      .actions button {
        padding: 5px 10px;
        font-size: 12px;
        margin: 0 2px;
      }
    }
  </style>
</head>
<body>

<script>
  // ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  const loggedInUser = JSON.parse(localStorage.getItem("loggedInUser"));
  if (!loggedInUser) {
    window.location.href = "login.html";
  }
</script>

<h1>ğŸ›ï¸ ØªØ·Ø¨ÙŠÙ‚ Ø¨ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª - Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¨Ø§Ø¦Ø¹</h1>

<div class="input-group">
  <input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" />
  <input id="price" placeholder="Ø§Ù„Ø³Ø¹Ø±" type="number" min="0" step="0.01" />
  <input id="quantity" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" type="number" min="0" step="1" />
  <button onclick="addProduct()">â• Ø¥Ø¶Ø§ÙØ©</button>
  <button id="clearAll" onclick="clearAllProducts()">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
</div>

<div class="input-group" style="justify-content: center; margin-bottom: 10px;">
  <input id="search" placeholder="ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬" oninput="renderProducts()" />
  <select id="sortBy" onchange="renderProducts()">
    <option value="">-- ÙØ±Ø² Ø­Ø³Ø¨ --</option>
    <option value="name">Ø§Ù„Ø§Ø³Ù…</option>
    <option value="price">Ø§Ù„Ø³Ø¹Ø±</option>
    <option value="quantity">Ø§Ù„ÙƒÙ…ÙŠØ©</option>
  </select>
</div>

<table>
  <thead>
    <tr>
      <th onclick="sortProducts('name')">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</th>
      <th onclick="sortProducts('price')">Ø§Ù„Ø³Ø¹Ø±</th>
      <th onclick="sortProducts('quantity')">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
      <th>Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª</th>
    </tr>
  </thead>
  <tbody id="productTable"></tbody>
</table>

<div id="totalValue">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: 0.00 Ø±ÙŠØ§Ù„</div>

<div class="message" id="messageBox"></div>

<script>
  let products = JSON.parse(localStorage.getItem("products") || "[]");
  let sortDirection = { name: 'asc', price: 'asc', quantity: 'asc' };
  let editingIndex = null;

  function showMessage(msg, duration = 2500) {
    const messageBox = document.getElementById("messageBox");
    messageBox.textContent = msg;
    messageBox.style.display = "block";
    setTimeout(() => {
      messageBox.style.display = "none";
    }, duration);
  }

  function saveProducts() {
    localStorage.setItem("products", JSON.stringify(products));
  }

  function addProduct() {
    const name = document.getElementById("name").value.trim();
    const price = parseFloat(document.getElementById("price").value);
    const quantity = parseInt(document.getElementById("quantity").value);

    if (!name || isNaN(price) || isNaN(quantity) || price < 0 || quantity < 0) {
      alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ (Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ÙƒÙ…ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ†Ø§ Ø£Ø¹Ø¯Ø§Ø¯Ø§Ù‹ Ù…ÙˆØ¬Ø¨Ø©)");
      return;
    }

    products.push({ name, price, quantity });
    saveProducts();
    renderProducts();
    showMessage(`âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ "${name}" Ø¨Ù†Ø¬Ø§Ø­`);

    document.getElementById("name").value = "";
    document.getElementById("price").value = "";
    document.getElementById("quantity").value = "";
  }

  function buyProduct(index) {
    if (products[index].quantity > 0) {
      products[index].quantity--;
      saveProducts();
      renderProducts();
      showMessage(`ğŸ›’ ØªÙ… Ø´Ø±Ø§Ø¡ ÙˆØ­Ø¯Ø© Ù…Ù† "${products[index].name}"`);
    } else {
      alert("âš ï¸ Ø§Ù„ÙƒÙ…ÙŠØ© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©");
    }
  }

  function deleteProduct(index) {
    if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ØŸ")) {
      const deletedName = products[index].name;
      products.splice(index, 1);
      saveProducts();
      renderProducts();
      showMessage(`ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ "${deletedName}"`);
    }
  }

  function clearAllProducts() {
    if (products.length === 0) {
      alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù„Ù…Ø³Ø­Ù‡Ø§");
      return;
    }
    if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§ØªØŸ")) {
      products = [];
      saveProducts();
      renderProducts();
      showMessage("ğŸ§¹ ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª");
    }
  }

  function editProduct(index) {
    if (editingIndex !== null) {
      alert("ğŸ”” ÙŠØ±Ø¬Ù‰ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø£ÙˆÙ„Ø§Ù‹");
      return;
    }
    editingIndex = index;
    renderProducts();
  }

  function saveEdit(index) {
    const nameInput = document.getElementById("editName");
    const priceInput = document.getElementById("editPrice");
    const quantityInput = document.getElementById("editQuantity");

    const newName = nameInput.value.trim();
    const newPrice = parseFloat(priceInput.value);
    const newQuantity = parseInt(quantityInput.value);

    if (!newName || isNaN(newPrice) || isNaN(newQuantity) || newPrice < 0 || newQuantity < 0) {
      alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„");
      return;
    }

    products[index] = { name: newName, price: newPrice, quantity: newQuantity };
    editingIndex = null;
    saveProducts();
    renderProducts();
    showMessage(`âœï¸ ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ "${newName}"`);
  }

  function cancelEdit() {
    editingIndex = null;
    renderProducts();
  }

  function sortProducts(key) {
    if (!key) return;
    let direction = sortDirection[key];
    products.sort((a, b) => {
      if (key === "name") {
        return direction === "asc"
          ? a.name.localeCompare(b.name)
          : b.name.localeCompare(a.name);
      } else {
        return direction === "asc" ? a[key] - b[key] : b[key] - a[key];
      }
    });
    sortDirection[key] = direction === "asc" ? "desc" : "asc";
    renderProducts();
  }

  function renderProducts() {
    const tbody = document.getElementById("productTable");
    tbody.innerHTML = "";

    const search = document.getElementById("search").value.trim().toLowerCase();
    const sortBy = document.getElementById("sortBy").value;

    let filtered = products.filter(p => p.name.toLowerCase().includes(search));

    if (sortBy) {
      let dir = sortDirection[sortBy];
      filtered.sort((a, b) => {
        if (sortBy === "name") {
          return dir === "asc" ? a.name.localeCompare(b.name) : b.name.localeCompare(a.name);
        } else {
          return dir === "asc" ? a[sortBy] - b[sortBy] : b[sortBy] - a[sortBy];
        }
      });
    }

    filtered.forEach((product, index) => {
      const realIndex = products.indexOf(product);
      const tr = document.createElement("tr");
      if (editingIndex === realIndex) {
        tr.classList.add("editing");
        tr.innerHTML = `
          <td><input id="editName" class="editInput" value="${product.name}" /></td>
          <td><input id="editPrice" class="editInput" type="number" min="0" step="0.01" value="${product.price}" /></td>
          <td><input id="editQuantity" class="editInput" type="number" min="0" step="1" value="${product.quantity}" /></td>
          <td class="actions">
            <button class="saveBtn" onclick="saveEdit(${realIndex})">Ø­ÙØ¸</button>
            <button class="cancelBtn" onclick="cancelEdit()">Ø¥Ù„ØºØ§Ø¡</button>
          </td>
        `;
      } else {
        tr.innerHTML = `
          <td>${product.name}</td>
          <td>${product.price.toFixed(2)}</td>
          <td>${product.quantity}</td>
          <td class="actions">
            <button onclick="buyProduct(${realIndex})" ${product.quantity === 0 ? 'disabled' : ''}>Ø´Ø±Ø§Ø¡</button>
            <button onclick="editProduct(${realIndex})">ØªØ¹Ø¯ÙŠÙ„</button>
            <button onclick="deleteProduct(${realIndex})">Ø­Ø°Ù</button>
          </td>
        `;
      }
      tbody.appendChild(tr);
    });

    updateTotalValue();
  }

  function updateTotalValue() {
    const total = products.reduce((sum, p) => sum + p.price * p.quantity, 0);
    document.getElementById("totalValue").textContent = `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: ${total.toFixed(2)} Ø±ÙŠØ§Ù„`;
  }

  renderProducts();
</script>

</body>
</html>
